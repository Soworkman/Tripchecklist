<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…è¡Œå‡ºç™¼å‰æª¢æŸ¥æ¸…å–® V.8 - Terry LAM</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --sub-color: #7f8c8d;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --border-color: #dcdde1;
            --text-color: #2f3640;
            --btn-text: #ffffff;
            --add-btn-bg: #f8f9fa;
        }

        /* ğŸŒ™ é»‘ç™½é«˜å°æ¯”æ·±è‰²æ¨¡å¼ */
        body.dark-theme {
            --primary-color: #ffffff;
            --accent-color: #3498db;
            --sub-color: #bdc3c7;
            --bg-color: #000000;
            --card-bg: #1a1a1a;
            --border-color: #444444;
            --text-color: #ffffff;
            --btn-text: #000000;
            --add-btn-bg: #2d2d2d;
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px 20px 40px 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .top-mode-controls {
            display: flex;
            justify-content: space-between;
            max-width: 1000px;
            margin: 0 auto 10px auto;
        }

        .mode-btn {
            background: var(--primary-color);
            color: var(--btn-text);
            border: 1px solid var(--primary-color);
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 1000px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }

        .header-section { text-align: center; margin-bottom: 30px; }
        
        /* æ¨™é¡Œèˆ‡ä½”ä½ç¬¦æ¨£å¼ */
        .main-title { 
            font-size: 2rem;
            font-weight: bold;
            border-bottom: 2px solid var(--primary-color);
            padding: 5px 20px;
            display: inline-block;
            color: var(--primary-color);
            outline: none;
            min-width: 200px;
        }
        .main-title:empty:before {
            content: attr(data-placeholder);
            color: var(--sub-color);
            font-weight: normal;
            font-style: italic;
            opacity: 0.5;
            cursor: text;
        }

        .sub-header { 
            font-size: 1.1rem;
            color: var(--sub-color);
            letter-spacing: 3px;
            margin-top: 10px;
            font-weight: bold;
        }

        .progress-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 95%; 
            margin: 20px auto;
        }
        .progress-container { flex: 1; background-color: var(--border-color); border-radius: 10px; height: 12px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background-color: var(--accent-color); transition: width 0.3s ease; }
        #progress-text { font-size: 0.95rem; color: var(--accent-color); font-weight: bold; min-width: 85px; text-align: right; }

        #main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            flex-grow: 1;
        }
        #main-content.mobile-layout { grid-template-columns: 1fr; }

        .category { 
            border: 1px solid var(--border-color); 
            border-radius: 6px; 
            padding: 18px; 
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            break-inside: avoid;
        }

        .category-title {
            font-size: 1.15rem;
            font-weight: bold;
            color: var(--primary-color);
            border-left: 5px solid var(--primary-color);
            padding-left: 12px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-list { flex-grow: 1; }
        .item { display: flex; align-items: flex-start; margin-bottom: 10px; }
        input[type="checkbox"] { width: 18px; height: 18px; margin-right: 12px; margin-top: 3px; cursor: pointer; }
        .editable-text { flex: 1; outline: none; border-bottom: 1px solid transparent; line-height: 1.5; font-size: 0.95rem; }
        .checked-text { text-decoration: line-through; color: var(--sub-color) !important; opacity: 0.5; }

        .add-item-btn {
            background: var(--add-btn-bg);
            border: 1px dashed var(--border-color);
            color: var(--primary-color);
            padding: 8px;
            font-size: 0.85rem;
            margin-top: 15px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            border-radius: 4px;
        }
        .add-item-btn:hover { background: var(--primary-color); color: var(--btn-text); }

        .action-bar {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 2px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .main-btn {
            padding: 12px 10px;
            font-size: 0.85rem;
            background: var(--primary-color);
            color: var(--btn-text);
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            transition: 0.2s;
        }
        .main-btn:hover { opacity: 0.85; transform: translateY(-1px); }

        .del-btn, .del-cat-btn { border: none; background: none; cursor: pointer; color: #ccc; font-size: 0.9rem; }
        .item:hover .del-btn, .category:hover .del-cat-btn { color: #999; }
        .del-btn:hover, .del-cat-btn:hover { color: #e74c3c !important; }

        @media print {
            .top-mode-controls, .action-bar, .del-btn, .del-cat-btn, .add-item-btn, .progress-wrapper { display: none !important; }
            body { background: white; color: black; padding: 0; }
            .container { box-shadow: none; width: 100%; padding: 0; border:none; }
            .category { border: 1px solid #000 !important; margin-bottom: 10px; }
            #main-content { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 15px !important; }
            .main-title:empty:before { content: ""; } /* åˆ—å°æ™‚éš±è—æç¤ºæ–‡å­— */
        }
    </style>
</head>
<body>

<div class="top-mode-controls">
    <button class="mode-btn" onclick="toggleDarkMode()">ğŸŒ“ æ·±æ·ºæ¨¡å¼</button>
    <button class="mode-btn" onclick="toggleLayout()">ğŸ“± é¡¯ç¤ºåˆ‡æ›</button>
</div>

<div class="container">
    <div class="header-section">
        <div id="list-title" class="main-title" contenteditable="true" data-placeholder="åœ¨æ­¤è¼¸å…¥æ—…è¡Œæ¨™é¡Œ..."></div>
        <div class="sub-header">å‡ºç™¼å‰æª¢æŸ¥æ¸…å–®</div>
        <div class="progress-wrapper">
            <div class="progress-container"><div id="progress-bar"></div></div>
            <div id="progress-text">0% å·²å®Œæˆ</div>
        </div>
    </div>
    
    <div id="main-content"></div>

    <input type="file" id="importFile" style="display:none" accept=".json" onchange="handleImport(this)">

    <div class="action-bar">
        <div class="btn-row">
            <button class="main-btn" onclick="addCategory()" style="background: #27ae60; border-color: #27ae60; color: white;">ï¼‹ æ–°å¢åˆ†é¡</button>
            <button class="main-btn" onclick="uncheckAll()" style="background: #7f8c8d; border-color: #7f8c8d; color: white;">ğŸ”“ å…¨éƒ¨å–æ¶ˆå‹¾é¸</button>
        </div>
        <div class="btn-row">
            <button class="main-btn" onclick="exportAsText()" style="background: #e67e22; border-color: #e67e22; color: white;">ğŸ“ å°å‡ºç´”æ–‡å­—</button>
            <button class="main-btn" onclick="exportAsJSON()" style="background: #2980b9; border-color: #2980b9; color: white;">ğŸ’¾ å‚™ä»½ JSON</button>
            <button class="main-btn" onclick="document.getElementById('importFile').click()" style="background: #8e44ad; border-color: #8e44ad; color: white;">ğŸ“‚ åŒ¯å…¥ JSON</button>
            <button class="main-btn" onclick="resetList()" style="background: #c0392b; border-color: #c0392b; color: white;">ğŸ”„ é‡è¨­é è¨­</button>
            <button class="main-btn" onclick="window.print()" style="background: #2c3e50; border-color: #2c3e50; color: white;">ğŸ–¨ï¸ åˆ—å° / PDF</button>
        </div>
    </div>

    <div class="footer" style="text-align:center; margin-top:30px; font-size:0.8rem; color:var(--sub-color);">
        è¨­è¨ˆè€…åŠç‰ˆæ¬Šæ‰€æœ‰ &copy; <span id="year"></span> <strong>Terry LAM</strong>. All Rights Reserved.
    </div>
</div>

<script>
    const initialData = [
        { title: "è­‰ä»¶èˆ‡æ–‡ä»¶", items: ["è­·ç…§ (ç¢ºèªæœ‰æ•ˆæœŸè‡³å°‘6å€‹æœˆä»¥ä¸Š)", "æ©Ÿç¥¨æˆ–é›»å­æ©Ÿç¥¨ç¢ºèªå–®", "ä½å®¿é…’åº—é è¨‚ç¢ºèªå–® (ç´™æœ¬å‚™ç”¨)", "æ—…éŠä¿éšªè­‰æ˜ (ä¿å–®ç·¨è™ŸåŠç·Šæ€¥ç†±ç·š)", "Visit Japan Web ç™»è¨˜ä¸¦æˆªåœ– QR Code", "2æ—¥(48å°æ™‚å‰)å‰å®Œæˆé è¾¦ç™»æ©Ÿæ‰‹çºŒ", "æµ·å¤–ä¸Šç¶²æœå‹™ (Simå¡å·²æ’å…¥æˆ–å„²å­˜eSIM)"] },
        { title: "é‡‘éŒ¢èˆ‡æ”¯ä»˜", items: ["æ—¥åœ“ç¾é‡‘ (Â¥ã€€ã€€ã€€ã€€ã€€ã€€)", "é å…ˆé–‹é€šéŠ€è¡Œæµ·å¤–ææ¬¾åŠŸèƒ½", "ä¿¡ç”¨å¡ (VISAã€Mastercard å„ä¸€)", "äº¤é€š IC å¡ (Suica / ICOCA)", "é–‹é€šå…«é”é€š App ä¹‹ PayPay åŠŸèƒ½"] },
        { title: "é›»å­è¨­å‚™", items: ["æ‰‹æ©Ÿå……é›»å™¨åŠå¤šå­”è½‰æ¥é ­", "å„é¡å……é›»ç·š (æ‰‹æ©Ÿã€è€³æ©Ÿã€æ‰‹éŒ¶)", "è¡Œå‹•é›»æº (éœ€æœ‰Cèªè­‰ï¼Œå¿…é ˆéš¨èº«å¸¶ä¸Šæ©Ÿ)", "ç„¡ç·šè€³æ©ŸåŠå……é›»ç›’", "é›»é¬šåˆ€åŠå…¶å……é›»è¨­å‚™", "ç¢ºèªæ‰‹æ©Ÿå‰©é¤˜å„²å­˜ç©ºé–“å……è¶³"] },
        { title: "è¡£ç‰©èˆ‡å€‹äººç”¨å“", items: ["æ—¥å¸¸æ›¿æ›è¡£ç‰© (åƒè€ƒç•¶åœ°æ°£æº«)", "è¼•ä¾¿å¤–å¥—æˆ–ä¿æº«å¤–å¥— (æ´‹è”¥å¼ç©¿æ³•)", "é…’åº—ç”¨å³æ£„æ‹–é‹ (æ©Ÿä¸Šäº¦é©ç”¨)", "å€‹äººè¡›ç”Ÿç”¨å“ (æ´—é ­æ°´ã€ç‰™åˆ·ã€ç‰™è†)", "æ²–æ¶¼ç”¨ã€æ´—è‡‰ç”¨åŠæº«æ³‰ç”¨å°æ¯›å·¾", "å¸¸ç”¨è—¥ç‰© (å¿…åˆ©ç—›ã€æ„Ÿå†’è—¥ã€ä¿æ¿Ÿä¸¸)", "é›¨å‚˜ (è¼•ä¾¿æ‘ºç–Šå‚˜)", "é˜²ç–«ç”¨å“ (å£ç½©ã€æ¶ˆæ¯’ç”¨å“ã€æ¿•ç´™å·¾)"] },
        { title: "æ–‡å…·èˆ‡å°èˆªç”¨å“", items: ["äº¤é€šåœ°éµéµè·¯è·¯ç·šåœ– (å¯åˆ—å°æˆ–ä¸‹è¼‰)", "è“‹å°ç« ç”¨çš„è¨˜äº‹æœ¬", "å¾¡æœ±å°æ‰‹å¸³ (å¦‚éœ€åƒæ‹œç¥ç¤¾)", "æ›¸å¯«ç”¨çš„åŸå­ç­† (æ©Ÿä¸Šå¡«è¡¨ç”¨)", "è† ç´™åŠå‰ªåˆ€ (æ³¨æ„ï¼šå‰ªåˆ€å¿…é ˆæ”¾é€²å¯„è‰™è¡Œæ)", "ä¸‹è¼‰é›¢ç·šåœ°åœ– (ä»¥å‚™ç¶²è·¯ä¸ç©©æ™‚ä½¿ç”¨)"] },
        { title: "å…¶ä»–æ³¨æ„äº‹é …", items: ["è¡Œç¨‹ã€ä¿éšªå‰¯æœ¬åŠè­‰ä»¶å‰¯æœ¬äº¤çµ¦å®¶äºº", "å®‰è£æ—…è¡Œç›¸é—œ App (Google Map, ç¿»è­¯ç­‰)", "ç¢ºèªå®¶ä¸­æ°´é›»ã€ç…¤æ°£åŠçª—æˆ¶å·²é—œå¥½", "æ¸…ç†å†°ç®±å…§æ˜“è®Šå£çš„é£Ÿç‰©"] }
    ];

    document.getElementById('year').textContent = new Date().getFullYear();

    function loadData() {
        const saved = localStorage.getItem('travelListData_v8');
        const savedTitle = localStorage.getItem('travelListTitle_v8');
        const isDark = localStorage.getItem('darkMode') === 'true';
        
        // å¦‚æœæœ‰å„²å­˜éçš„æ¨™é¡Œæ‰é¡¯ç¤ºï¼Œå¦å‰‡ç¶­æŒ HTML è£¡çš„ç©ºç‹€æ…‹ï¼ˆè§¸ç™¼ä½”ä½ç¬¦ï¼‰
        if (savedTitle) {
            document.getElementById('list-title').innerText = savedTitle;
        }
        
        if (isDark) document.body.classList.add('dark-theme');
        return saved ? JSON.parse(saved) : initialData;
    }

    function saveData() {
        const data = [];
        document.querySelectorAll('.category').forEach(cat => {
            const title = cat.querySelector('.category-title span').innerText;
            const items = Array.from(cat.querySelectorAll('.item')).map(item => ({
                text: item.querySelector('.editable-text').innerText,
                checked: item.querySelector('input').checked
            }));
            data.push({ title, items });
        });
        localStorage.setItem('travelListData_v8', JSON.stringify(data));
        // å„²å­˜æ¨™é¡Œ
        localStorage.setItem('travelListTitle_v8', document.getElementById('list-title').innerText);
        updateProgress();
    }

    function createItemNode(text, checked = false) {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
            <input type="checkbox" ${checked ? 'checked' : ''} onchange="toggleStatus(this)">
            <span class="editable-text ${checked ? 'checked-text' : ''}" contenteditable="true" oninput="saveData()">${text}</span>
            <button class="del-btn" onclick="this.parentElement.remove(); saveData()">âœ•</button>
        `;
        return div;
    }

    function createCategory(title, items = []) {
        const catDiv = document.createElement('div');
        catDiv.className = 'category';
        catDiv.innerHTML = `
            <div class="category-title">
                <span contenteditable="true" oninput="saveData()">${title}</span>
                <button class="del-cat-btn" onclick="if(confirm('ç¢ºå®šåˆªé™¤æ•´å€‹åˆ†é¡ï¼Ÿ')){this.closest('.category').remove(); saveData()}">âœ•</button>
            </div>
            <div class="item-list"></div>
            <button class="add-item-btn" onclick="addItem(this)">ï¼‹ å¢åŠ é …ç›®</button>
        `;
        const list = catDiv.querySelector('.item-list');
        items.forEach(it => list.appendChild(createItemNode(typeof it === 'string' ? it : it.text, it.checked || false)));
        return catDiv;
    }

    function addItem(btn) {
        btn.previousElementSibling.appendChild(createItemNode(""));
        saveData();
    }

    function addCategory() {
        document.getElementById('main-content').appendChild(createCategory("æ–°åˆ†é¡"));
        saveData();
    }

    function toggleStatus(cb) {
        cb.nextElementSibling.classList.toggle('checked-text', cb.checked);
        saveData();
    }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-theme');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-theme'));
    }

    function toggleLayout() {
        document.getElementById('main-content').classList.toggle('mobile-layout');
    }

    function uncheckAll() {
        if(confirm("ç¢ºå®šè¦å–æ¶ˆå‹¾é¸æ‰€æœ‰é …ç›®å—ï¼Ÿ")) {
            document.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => {
                cb.checked = false;
                cb.nextElementSibling.classList.remove('checked-text');
            });
            saveData();
        }
    }

    function resetList() {
        if(confirm("ç¢ºå®šè¦æ¢å¾©é è¨­æ¸…å–®ï¼Ÿç¾æœ‰å…§å®¹å°‡è¢«è¦†è“‹ã€‚")) {
            localStorage.clear();
            location.reload();
        }
    }

    function updateProgress() {
        const total = document.querySelectorAll('input[type="checkbox"]').length;
        const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
        const percent = total === 0 ? 0 : Math.round((checked / total) * 100);
        document.getElementById('progress-bar').style.width = percent + "%";
        document.getElementById('progress-text').innerText = percent + "% å·²å®Œæˆ";
    }

    function exportAsText() {
        let txt = `ğŸ“‹ ${document.getElementById('list-title').innerText || 'æœªå‘½åè¡Œç¨‹'}\n\n`;
        document.querySelectorAll('.category').forEach(cat => {
            txt += `ã€${cat.querySelector('.category-title span').innerText}ã€‘\n`;
            cat.querySelectorAll('.item').forEach(it => {
                const checked = it.querySelector('input').checked;
                const text = it.querySelector('.editable-text').innerText;
                txt += `${checked ? 'âœ…' : 'â¬œ'} ${text}\n`;
            });
            txt += `\n`;
        });
        downloadFile(txt, 'travel_list.txt', 'text/plain');
    }

    function exportAsJSON() {
        const data = [];
        document.querySelectorAll('.category').forEach(cat => {
            const title = cat.querySelector('.category-title span').innerText;
            const items = Array.from(cat.querySelectorAll('.item')).map(item => ({
                text: item.querySelector('.editable-text').innerText,
                checked: item.querySelector('input').checked
            }));
            data.push({ title, items });
        });
        downloadFile(JSON.stringify(data, null, 2), 'checklist_backup.json', 'application/json');
    }

    function handleImport(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (Array.isArray(data)) {
                    localStorage.setItem('travelListData_v8', JSON.stringify(data));
                    location.reload();
                } else { alert("å‚™ä»½æ ¼å¼ä¸æ­£ç¢ºã€‚"); }
            } catch (err) { alert("è®€å–æª”æ¡ˆå¤±æ•—ã€‚"); }
        };
        reader.readAsText(file);
    }

    function downloadFile(content, fileName, type) {
        const blob = new Blob([content], {type: type});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = fileName;
        a.click();
    }

    const contentDiv = document.getElementById('main-content');
    loadData().forEach(cat => contentDiv.appendChild(createCategory(cat.title, cat.items)));
    document.getElementById('list-title').addEventListener('input', saveData);
    updateProgress();
</script>
</body>
</html>
